# Классификация текста: тональность и стиль

Проект для обучения нейронных сетей, которые определяют:
1. **Тональность текста** (sentiment): `positive` / `negative`
2. **Стиль написания** (style): `colloquial` / `journalistic` / `literary`

Использует **semi-supervised learning** (pseudo-labeling) с нейронной сетью на PyTorch для обучения на размеченных и неразмеченных данных.

## Структура проекта

```
text_classifier/
├── data/
│   ├── sentiment_labeled.csv      # Размеченные данные для тональности (84 примера)
│   ├── sentiment_unlabeled.csv    # Неразмеченные данные для тональности (62 примера)
│   ├── style_labeled.csv          # Размеченные данные для стиля (87 примеров)
│   └── style_unlabeled.csv        # Неразмеченные данные для стиля (78 примеров)
├── models/                        # Сохранённые модели (создаётся после обучения)
│   ├── sentiment_model.pth        # Модель нейросети для тональности
│   ├── sentiment_vocab.pkl        # Словарь для тональности
│   ├── sentiment_encoder.pkl     # LabelEncoder для тональности
│   ├── style_model.pth            # Модель нейросети для стиля
│   ├── style_vocab.pkl            # Словарь для стиля
│   └── style_encoder.pkl          # LabelEncoder для стиля
├── train.py                       # Скрипт обучения нейронных сетей
├── predict.py                     # Скрипт для предсказаний
├── test_model.py                  # Скрипт для тестирования качества
├── check_data.py                  # Скрипт для анализа данных
├── requirements.txt               # Зависимости
├── MODEL_EXPLANATION.md           # Подробное объяснение работы модели
└── README.md                      # Этот файл
```

## Установка

```bash
cd module4/text_classifier
pip install -r requirements.txt
```

## Обучение моделей

```bash
python train.py
```

Скрипт:
1. Загружает размеченные и неразмеченные данные из CSV
2. Создаёт словарь из всех слов
3. Обучает нейронную сеть на размеченных данных
4. Применяет **pseudo-labeling** (semi-supervised learning):
   - Предсказывает метки для неразмеченных данных
   - Берёт только высокоуверенные предсказания (порог 0.85)
   - Переобучает модель на размеченных + псевдо-размеченных данных
5. Сохраняет модели, словари и encoders в папку `models/`

### Архитектура нейронной сети

```
Embedding (305 слов × 128 размерность)
  ↓
Global Average Pooling (усреднение по последовательности)
  ↓
Dense (128 → 32) + ReLU
  ↓
Dropout (30%)
  ↓
Dense (32 → 2-3) + Softmax
```

**Параметры модели:**
- Embedding: ~39,040 параметров (90%)
- Dense 1: ~4,128 параметров (9.5%)
- Dense 2: ~66-99 параметров (0.2%)
- **Всего: ~43,000-44,000 параметров**

### Что такое Pseudo-labeling?

**Pseudo-labeling** — метод semi-supervised learning, который:
- Обучает модель на размеченных данных
- Предсказывает метки для неразмеченных данных
- Берёт только высокоуверенные предсказания (порог 0.85)
- Переобучает модель на объединённых данных

Это позволяет использовать неразмеченные данные для улучшения качества модели.

## Использование моделей

### Через скрипт predict.py

```bash
python predict.py
```

### Программно

```python
from predict import predict_sentiment, predict_style, analyze_text

# Предсказать тональность
sentiment = predict_sentiment("Это отличный фильм!")
print(sentiment)  # positive или negative

# Предсказать стиль
style = predict_style("Привет, как дела?")
print(style)  # colloquial, journalistic или literary

# Полный анализ
result = analyze_text("Величественные горы возвышались над долиной.")
print(result)
# {
#     'text': '...',
#     'sentiment': 'positive',
#     'style': 'literary'
# }
```

## Тестирование качества

```bash
python test_model.py
```

Скрипт проверяет качество моделей на известных примерах и выводит процент правильных предсказаний.

## Анализ данных

```bash
python check_data.py
```

Скрипт анализирует данные:
- Баланс классов
- Длину текстов
- Количество слов
- Примеры текстов по классам

## Формат данных

### CSV файлы с размеченными данными

```csv
text,sentiment
"Это отличный фильм, мне очень понравилось!",positive
"Ужасное обслуживание, никогда больше не приду.",negative
```

```csv
text,style
"Привет, как дела? Давай встретимся завтра.",colloquial
"По данным статистики, уровень безработицы снизился.",journalistic
"Величественные горы возвышались над долиной.",literary
```

**Важно:** Тексты должны быть в кавычках, если содержат запятые!

### CSV файлы с неразмеченными данными

```csv
text
"Фильм оказался довольно интересным, стоит посмотреть."
"Покупка была удачной, вещь качественная."
```

## Алгоритм обучения

1. **Токенизация**: создание словаря из всех слов
2. **Преобразование текстов**: тексты → последовательности индексов
3. **Обучение на размеченных данных**: нейросеть обучается 100-200 эпох
4. **Pseudo-labeling**: предсказание меток для неразмеченных данных
5. **Переобучение**: fine-tuning на размеченных + псевдо-размеченных данных
6. **Оценка качества**: accuracy и classification report
7. **Сохранение**: модели (.pth), словари и encoders (.pkl)

## Добавление своих данных

1. Добавьте размеченные примеры в `data/sentiment_labeled.csv` или `data/style_labeled.csv`
2. Добавьте неразмеченные примеры в `data/sentiment_unlabeled.csv` или `data/style_unlabeled.csv`
3. **Важно:** Тексты с запятыми должны быть в кавычках!
4. Запустите `python train.py` для переобучения

## Зависимости

- `pandas` — работа с CSV
- `scikit-learn` — метрики и LabelEncoder
- `numpy` — численные операции
- `joblib` — сохранение/загрузка словарей и encoders
- `torch` (PyTorch) — нейронные сети

## Подробное объяснение

Подробное объяснение работы модели, архитектуры, параметров и алгоритма обучения смотрите в [MODEL_EXPLANATION.md](MODEL_EXPLANATION.md).

## Примеры использования

### Обучение моделей

```bash
python train.py
```

Вывод покажет:
- Архитектуру нейронной сети
- Количество параметров
- Процесс обучения (loss, accuracy)
- Распределение предсказаний
- Результаты pseudo-labeling
- Финальную точность

### Предсказание

```bash
python predict.py
```

Вывод покажет предсказания для тестовых примеров.

### Тестирование

```bash
python test_model.py
```

Вывод покажет процент правильных предсказаний для каждого класса.
